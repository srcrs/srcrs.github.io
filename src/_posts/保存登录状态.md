---
title: 保存登录状态
date: 2020-06-01
category: Note
tags:
    - token
---

:::tip
`http`请求是无状态的，也就是请求一次的状态并不会保存下来，有的网站的一些操作权限只支持登录的用户，以前做的登录就是请求一次`API`，验证有没有这个用户，就假装登陆了。如何授权并保持这样的登录状态呢？
:::

<!-- more -->

保存登录状态有大致两种方式，两者的区分点就是存不存在跨域的问题（跨域可以简单理解为，一个地址要请求另一个地址的内容）。 

如果不存在跨域的问题，可以采用`cookie`(在客户端记录状态)和`session`(在服务端记录状态)的方式保存登录状态。客户端和服务器之间通常都是存在跨域的问题，因此就需要采用`token`的方式保存登录状态。

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="572px" viewBox="-0.5 -0.5 572 345" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2020-05-28T08:39:53.186Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36&quot; etag=&quot;mwDp8Vov1GDObwDZ9J9b&quot; version=&quot;13.1.3&quot;&gt;&lt;diagram id=&quot;PQsuAjaLIpzGLL3Y-lxF&quot; name=&quot;第 1 页&quot;&gt;7VlLc+I4EP41OoayJNtIRxvIzB62amqzVZs5GluAdwxmjQmwv35bsvyQbR7JAkmmJgcitaTWo7/+uiUjOlruv2TBevF7GokEESvaIzpGhHDK4FcKDoWAWbwQzLM4KkS4FjzF/wottLR0G0diY3TM0zTJ47UpDNPVSoS5IQuyLN2Z3WZpYs66DuaiI3gKg6Qr/SuO8oXeBRnW8q8ini/KmbGr97cMys56J5tFEKW7hohOEB1laZoXpeV+JBJ5duW5FOMej7RWC8vEKr9kgLcON7+toz/E899frB/Py5398P1Ba3kJkq3eMCJuAvr8WQpqYdX5QR+F+882LRseNspQHnTAbL2vG6E01/+VlmklmLjIdxB7RBOGvCFiDE0cxDnyWNkXlj5tjwdZsZBSTIw1kSzdriIhd2hB824R5+JpHYSydQd4BNkiXyZQw1AMpps02ebCy0INNCWtazZUN3mW/qhsTeSG4yQZpUmaqSnpbCbcMKx6NlqiIZ9aVrXMF5HlYn/UWrjCAPiOSJcizw7QZV/6STFCuw0uUbSrQYhdLVs0AEjLjoEG/rxSXWMDChoer4AKuSdU+AixsUQI85CHPytUIkewyO6DCiNT6rrXgYrNPxxWaA9WWuYAOlzL4iwRe08SNRyGWEW6OA6TYLOJQ9Mq5YZc1RcW+qytqSrfZWVgUVwKxvtm8/jQrH0TWQx7FZkWFusTUScatKwA4SfI5iI/5yhdazWs4fQYo5RlIgny+MVcRp+B9Azf0lh5nwYDsdtg4KaKTbrNQqFHNcNFSxFtMRBrYaU4ho4eBZdq129HkN1F0GSIuC1JAPgBwoc/VBKOfF/ygz9G3OmgDLwqb3l2Es9XEmBgV2l9X/peDAHf0w3LOIrkcD8TQF3BVKmSEFnLvardOz5yxlLXNk83NT1cwZcpdUzzWV1f7nPlm3myc0dPxqYnE8zPefI+zp8Lr7dcXTfGQr0eKisnOUD2eDsvFI51PoCe5Y8jCLkTfwxNt7etFrIu5Q/HtgbcbesaYHIRjQB4gkOjm/a9GxCN20M0kGp4iI1UqvqIGJYS4D/uSYkPkqFiHKAeV7MSf9SsBLFYSnzkqwTX96D1T4j9q09PTYS1qMm9MM24GTcNz3PTOR4qGQQPrIoxCgahhJ1mkB6yqJmsVFezmU3ZGTYzE9T/maWcZaNLs5l3ZSNKTTaq2OnV2QxuKeKXpTPHeejIPKQ1D3FOr6vd3zUu8VAoVnBVyuO3j+mXAvWjpMkVPl4LrPblq6PoxnlyOZ0Rv1wZhiD0yAAEIcwtAtBEPb/wMprJsKbim0ykXeRjxLo4+GxBilpmkKquLc0gRe4ZpMqExzCQgzy4rqgMAQ7dYz9HhtBh6/Iy0zj84V3P/oJ3iEszhAe4ZGBipAhDi749Raj11TkCw+6ZHKE3KzAThyvmCJfeWN71xYPaV7qx2K0cwW7j8ko5Qnseap/OETr9Gb59joD7HmDa96Kfk7ao89609evR5WNnj5D0weYbf613DvpGBiKUDyz7tK53fzDBfS8m6lmE2+pDjY/4pPsIorJSKFvqoWSMvMnnJw5yJPI0UMivQxxQrb8UF5asP7fTyX8=&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://app.diagrams.net/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:345px;"><defs/><g><rect x="1" y="20" width="160" height="320" fill="#ffe6cc" stroke="#d79b00" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 158px; height: 1px; padding-top: 180px; margin-left: 2px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px"><b>浏览器</b></font></div></div></div></foreignObject><text x="81" y="184" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">浏览器</text></switch></g><rect x="411" y="20" width="160" height="320" fill="#d5e8d4" stroke="#82b366" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 158px; height: 1px; padding-top: 180px; margin-left: 412px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px"><b>服务器</b></font></div></div></div></foreignObject><text x="491" y="184" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">服务器</text></switch></g><path d="M 161.49 32 L 161.51 26 L 391.51 26.85 L 391.55 16.35 L 410.5 29.92 L 391.45 43.35 L 391.49 32.85 Z" fill="none" stroke="#000000" stroke-linejoin="round" stroke-miterlimit="10" pointer-events="all"/><rect x="256" y="0" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 10px; margin-left: 286px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">用户登录</div></div></div></foreignObject><text x="286" y="14" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">用户登录</text></switch></g><path d="M 411.46 87.08 L 411.46 93.08 L 180.5 93.08 L 180.5 103.58 L 161.5 90.08 L 180.5 76.58 L 180.5 87.08 Z" fill="none" stroke="#000000" stroke-linejoin="round" stroke-miterlimit="10" pointer-events="all"/><rect x="206" y="60" width="160" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 70px; margin-left: 286px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">验证通过并生成相应Token</div></div></div></foreignObject><text x="286" y="74" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证通过并生成相应Token</text></switch></g><path d="M 164.04 124.96 L 241 125 L 241 160 L 170.41 160.15" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 165.16 160.16 L 172.15 156.64 L 170.41 160.15 L 172.17 163.64 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 161.5 213 L 161.5 207 L 391.5 207 L 391.5 196.5 L 410.5 210 L 391.5 223.5 L 391.5 213 Z" fill="none" stroke="#000000" stroke-linejoin="round" stroke-miterlimit="10" pointer-events="all"/><rect x="226" y="180" width="120" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 190px; margin-left: 286px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">携带Token发送请求</div></div></div></foreignObject><text x="286" y="194" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">携带Token发送请求</text></switch></g><rect x="251" y="135" width="70" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 145px; margin-left: 286px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">存储Token</div></div></div></foreignObject><text x="286" y="149" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">存储Token</text></switch></g><path d="M 409.08 244.96 L 331 245 L 331 281 L 402.71 281.11" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 407.96 281.12 L 400.96 284.61 L 402.71 281.11 L 400.97 277.61 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="251" y="255" width="70" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 265px; margin-left: 286px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">验证Token</div></div></div></foreignObject><text x="286" y="269" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证Token</text></switch></g><path d="M 410.5 327 L 410.5 333 L 179.54 333 L 179.54 343.5 L 160.54 330 L 179.54 316.5 L 179.54 327 Z" fill="none" stroke="#000000" stroke-linejoin="round" stroke-miterlimit="10" pointer-events="all"/><rect x="241" y="300" width="90" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 310px; margin-left: 286px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">返回相应数据</div></div></div></foreignObject><text x="286" y="314" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">返回相应数据</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>

## 注册流程

保存登录状态首先肯定是对于注册的用户来说的，先来看看注册流程，比较简单一点。对于注册页面不应该被拦截。由于`token`中包含了密码，`token`对于别人来说相当于明文，加密就是用的`base64`，很好解开，所以一旦`token`泄露就很危险了，这里密码和账户最好用`BCR`加密一下。

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="539px" viewBox="-0.5 -0.5 539 300" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2020-05-31T16:32:39.642Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36&quot; etag=&quot;sPsebaYH_X_00P57mmdP&quot; version=&quot;13.1.8&quot;&gt;&lt;diagram id=&quot;PQsuAjaLIpzGLL3Y-lxF&quot; name=&quot;第 1 页&quot;&gt;3VrbcqM4EP0aPSbF/fIIvuxM7exudvOQydOWAhqbGmy5hDy29+tXAnETOMYMGGeqUimpaQmp+/RRqw3QZ5vjbwTu1n/gEMVAU8Ij0OdA01zdYf+54JQJHMXNBCsShZlILQXP0X9ICBUh3UchSmqKFOOYRru6MMDbLQpoTQYJwYe62jcc19+6gyvUEDwHMG5KX6KQrsUuNLuUf0LRap2/WbXE/jYwVxY7SdYwxIeKSF8AfUYwpllrc5yhmNsut0s2bnnmabEwgra0y4DAenl9+VNff1nMjw/m599P/8Z/P2jZLD9gvBcbBgsT+DPgKLzh2cDxxfLpKbdJQgn+XpiDbcRf003Mmiprsm3uuN7muOKAePwW40OwhoQ+UkQ20RZSTJjaYR1R9LyDAdc9ME0mI3i/DRFfrsJ6YmWIUHQ8u2W1MCQDIMIbRMmJqYgBmi1sL8CXdw8VTwrRuuJEQ8igwM6qmLg0L2sIC19hbb3V2p4KPJ83HAu4LlgYwHeA56UNj//xxpKrLSzgMOVlwyN1y7XZtuIh+JbgeE+RRwIRb6m07BncjQ0fD+EPs+4P1Wg6RNVu6RGjxSMW8PQU/8wdzOwmWNjANYDnpPZ3gG+njxzuCOY1VwGelfpxzoVcMuPKv4iPCiaezEdmw0d/fQeLJWcptxkKPckpREGURHg7FTUVRHSBm5yxrGy3cxMzsysajJ5YJHgK56CFwynJ9XmDEZMzS/nL408L5Q8aAMbdkZTb4pr0SHDnFd5hHjEEEznLlKQaXvtFPKLpU3sk58SaS2zg+8DV08NhPiA13T5vMiRy0rWJEye1JXOSrYu2occTftYLYpgkUVA3MNs7OX3lRno08+6rsFnamR9rvVPeO0a0Moz1XvMZWbscxDvVMU+IRGz3iNT8gsLGfUPyCtsU3pMAXc7aKSQrRC/lm00vV7xotngxlxEUQxr9qC+3zbXiDU84YhspQKRKIFItCR3ZNsWo6sVFmqi4QeUTqdJEmR0aE6VIK7b9E+BrSRLvGXwDAk3vCDRjSqDpMj60nkBrTGTeGGjNTPeugZbOMCLNGR3RZ06KPl0Cjd4XffJEMl+OjT5rAPQNdFaWKK5huIT0GRQPCD7zQ5yxxplE7Vrwqa6UYtvdwMfQAE8VtR1XSM4vWD7LdUt5d12Ns7+uzxrZCoaNhJa7cN9IUCtxUEZFn0i4js8niAR7ykgwlDpQiv61kSBfNvWOScC1kSAvWJfL9xf08yz4nL6pvqs/UuQ405whA6Ld7oh2d0q0WxLvF/R9LdotifdV+Qo/dtLRUtv6YIBxOwJGVcCUiLEGyhRstV+mMBRi8nVXEOPP/ulQfuYVsSiA8Rf4huInnEQ0LffP3zCleMMwkSt4cbTiDyiWKqB5iW5HcICS5GI1Lh2TFUeVx7Q8WlZLrbGKpZZ8jZi8fJ3v4b0Y7/urDaTwDSboVoVROYq0lsKo1WJb+So3nG214fiznqpqF3LVMzc07YZXtK5HtTYp85ryESuXLzuf1dKhf+P6gDZEDT4/qmtQsztCTa1Dzb4h1PI4v+9LkAy1xtncF2qanC2MjbUhSu4/RWsPyqOi2nXA6aXgXBV15Ipo11zz3DF2o1xTShEbV+jOMJSTVvlSPzYMhyzIj8ded35XNd06l/T9HbBBSvK3ML3RwLrld5iZevkxq774Hw==&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://app.diagrams.net/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:300px;"><defs/><g><path d="M 81.49 1 L 112.51 1 C 126.04 1 137 9.95 137 21 C 137 32.05 126.04 41 112.51 41 L 81.49 41 C 67.96 41 57 32.05 57 21 C 57 9.95 67.96 1 81.49 1 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 21px; margin-left: 58px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">开始</div></div></div></foreignObject><text x="97" y="25" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">开始</text></switch></g><rect x="37" y="71" width="120" height="40" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 91px; margin-left: 38px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">填写个人信息</div></div></div></foreignObject><text x="97" y="95" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">填写个人信息</text></switch></g><rect x="37" y="141" width="120" height="40" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 161px; margin-left: 38px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">检查用户是否存在</div></div></div></foreignObject><text x="97" y="165" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">检查用户是否存在</text></switch></g><path d="M 97 211 L 137 251 L 97 291 L 57 251 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 251px; margin-left: 58px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Ok？</div></div></div></foreignObject><text x="97" y="255" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Ok？</text></switch></g><rect x="237" y="71" width="120" height="40" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 91px; margin-left: 238px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">对密码进行加密</div></div></div></foreignObject><text x="297" y="95" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">对密码进行加密</text></switch></g><rect x="237" y="161" width="120" height="40" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 181px; margin-left: 238px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">保存账号密码</div></div></div></foreignObject><text x="297" y="185" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">保存账号密码</text></switch></g><path d="M 281.49 251 L 312.51 251 C 326.04 251 337 259.95 337 271 C 337 282.05 326.04 291 312.51 291 L 281.49 291 C 267.96 291 257 282.05 257 271 C 257 259.95 267.96 251 281.49 251 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 271px; margin-left: 258px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">结束</div></div></div></foreignObject><text x="297" y="275" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">结束</text></switch></g><path d="M 97 41 L 97 64.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 97 69.88 L 93.5 62.88 L 97 64.63 L 100.5 62.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 97 111 L 97 134.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 97 139.88 L 93.5 132.88 L 97 134.63 L 100.5 132.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 97 181 L 97 204.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 97 209.88 L 93.5 202.88 L 97 204.63 L 100.5 202.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 97 291 L 17 291 Q 7 291 7 281 L 7 101 Q 7 91 17 91 L 30.63 91" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 35.88 91 L 28.88 94.5 L 30.63 91 L 28.88 87.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 137 251 L 177 251 Q 187 251 187 241 L 187 51 Q 187 41 197 41 L 287 41 Q 297 41 297 51 L 297 64.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 297 69.88 L 293.5 62.88 L 297 64.63 L 300.5 62.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 297 111 L 297 154.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 297 159.88 L 293.5 152.88 L 297 154.63 L 300.5 152.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 297 201 L 297 244.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 297 249.88 L 293.5 242.88 L 297 244.63 L 300.5 242.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="417" y="71" width="120" height="40" rx="2.4" ry="2.4" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><path d="M 434 71 L 434 111 M 520 71 L 520 111" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 118px; margin-left: 418px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">BCR加密</div></div></div></foreignObject><text x="477" y="130" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">BCR加密</text></switch></g><path d="M 447 201 L 447 161 C 447 155.48 460.43 151 477 151 C 493.57 151 507 155.48 507 161 L 507 201 C 507 206.52 493.57 211 477 211 C 460.43 211 447 206.52 447 201 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 447 161 C 447 166.52 460.43 171 477 171 C 493.57 171 507 166.52 507 161" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 357 81 L 410.63 81" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 415.88 81 L 408.88 84.5 L 410.63 81 L 408.88 77.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 417 101 L 363.37 101" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 358.12 101 L 365.12 97.5 L 363.37 101 L 365.12 104.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 357 171 L 439.61 170.09" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 444.86 170.03 L 437.9 173.61 L 439.61 170.09 L 437.82 166.61 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 446 191 L 363.37 191" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 358.12 191 L 365.12 187.5 L 363.37 191 L 365.12 194.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>

## 登录流程

登录的流程，首先访问登录页面，把本地存储的文件都带上，主要就是看是否含有`token`令牌，然后登录被拦截，如果未含有`token`就直接输入账号密码，验证用户的身份，如果验证通过，就可以生成一个新的令牌，交给用户然后本地存储操作，如果用户名或者密码错误，就提示用户重新输入，再次验证身份。如果本地含有令牌，就验证令牌是否有效，如果令牌失效，就重新输入账号密码验证身份，颁发新的令牌。登录流程主要就是能得到一个能使用的令牌。

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="692px" viewBox="-0.5 -0.5 692 422" style="max-width:100%;max-height:422px;"><defs/><g><rect x="1" y="10" width="45" height="180" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 100px; margin-left: 2px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">登<br />录</div></div></div></foreignObject><text x="24" y="104" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">登&#xa;录</text></switch></g><rect x="216" y="10" width="45" height="100" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 60px; margin-left: 217px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">拦<br />截</div></div></div></foreignObject><text x="239" y="64" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">拦&#xa;截</text></switch></g><rect x="216" y="160" width="45" height="190" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 255px; margin-left: 217px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">令<br />牌</div></div></div></foreignObject><text x="239" y="259" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">令&#xa;牌</text></switch></g><path d="M 600.18 10 L 681.82 10 C 686.89 10 691 23.43 691 40 C 691 56.57 686.89 70 681.82 70 L 600.18 70 C 595.11 70 591 56.57 591 40 C 591 23.43 595.11 10 600.18 10 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 681.82 10 C 676.74 10 672.63 23.43 672.63 40 C 672.63 56.57 676.74 70 681.82 70" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 40px; margin-left: 592px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DB</div></div></div></foreignObject><text x="641" y="44" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DB</text></switch></g><rect x="416" y="10" width="45" height="110" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 65px; margin-left: 417px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">验<br />证<br />账<br />号<br />密<br />码</div></div></div></foreignObject><text x="439" y="69" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证账号密码...</text></switch></g><rect x="416" y="150" width="45" height="120" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 210px; margin-left: 417px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">验<br />证<br />令<br />牌</div></div></div></foreignObject><text x="439" y="214" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证令牌...</text></switch></g><rect x="619.75" y="90" width="42.5" height="330" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 41px; height: 1px; padding-top: 255px; margin-left: 621px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">生<br />成<br />令<br />牌</div></div></div></foreignObject><text x="641" y="259" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">生成令牌...</text></switch></g><path d="M 510.18 288 L 591.82 288 C 596.89 288 601 301.43 601 318 C 601 334.57 596.89 348 591.82 348 L 510.18 348 C 505.11 348 501 334.57 501 318 C 501 301.43 505.11 288 510.18 288 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><path d="M 591.82 288 C 586.74 288 582.63 301.43 582.63 318 C 582.63 334.57 586.74 348 591.82 348" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 318px; margin-left: 502px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DB</div></div></div></foreignObject><text x="551" y="322" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DB</text></switch></g><path d="M 46 29.98 L 208.63 30" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 213.88 30 L 206.88 33.5 L 208.63 30 L 206.88 26.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 261 29 L 409.63 30.82" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 414.88 30.89 L 407.84 34.3 L 409.63 30.82 L 407.93 27.3 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 461 29.8 L 584.63 29.97" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 589.88 29.98 L 582.88 33.47 L 584.63 29.97 L 582.89 26.47 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 593 53.02 L 467.37 56.05" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 462.12 56.17 L 469.03 52.51 L 467.37 56.05 L 469.2 59.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 261 85 L 291 85 Q 301 85 301 95 L 301 172 Q 301 182 291 182 L 267.37 182" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 262.12 182 L 269.12 178.5 L 267.37 182 L 269.12 185.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 262 210 L 409.63 210" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 414.88 210 L 407.88 213.5 L 409.63 210 L 407.88 206.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 415.01 255 L 267.37 255" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 262.12 255 L 269.12 251.5 L 267.37 255 L 269.12 258.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 416 60.05 L 267.37 60" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 262.12 60 L 269.12 56.5 L 267.37 60 L 269.12 63.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 217 78 L 51.38 77" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 46.13 76.97 L 53.15 73.51 L 51.38 77 L 53.11 80.51 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="86" y="0" width="90" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 10px; margin-left: 131px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">进入登录页面</div></div></div></foreignObject><text x="131" y="14" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">进入登录页面</text></switch></g><rect x="46" y="80" width="170" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 90px; margin-left: 131px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">已登录或验证失败或令牌失效</div></div></div></foreignObject><text x="131" y="94" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">已登录或验证失败或令牌失效</text></switch></g><rect x="281" y="0" width="100" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 10px; margin-left: 331px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">输入用户名密码</div></div></div></foreignObject><text x="331" y="14" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">输入用户名密码</text></switch></g><rect x="471" y="0" width="100" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 10px; margin-left: 521px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">验证用户名密码</div></div></div></foreignObject><text x="521" y="14" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证用户名密码</text></switch></g><path d="M 461 100.97 L 614.61 100.89" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 619.86 100.89 L 612.87 104.39 L 614.61 100.89 L 612.86 97.39 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="307" y="190" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 200px; margin-left: 337px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">验证令牌</div></div></div></foreignObject><text x="337" y="204" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证令牌</text></switch></g><rect x="315" y="260" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 270px; margin-left: 345px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">令牌失效</div></div></div></foreignObject><text x="345" y="274" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">令牌失效</text></switch></g><rect x="356" y="320" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 330px; margin-left: 386px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">令牌有效</div></div></div></foreignObject><text x="386" y="334" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">令牌有效</text></switch></g><path d="M 238.5 160 L 238.5 116.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 238.5 111.12 L 242 118.12 L 238.5 116.37 L 235 118.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="176" y="130" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 140px; margin-left: 206px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">令牌失效</div></div></div></foreignObject><text x="206" y="144" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">令牌失效</text></switch></g><rect x="307" y="100" width="30" height="60" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 130px; margin-left: 322px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">存<br />在<br />令<br />牌</div></div></div></foreignObject><text x="322" y="134" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">存在令牌...</text></switch></g><rect x="1" y="230" width="45" height="170" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 315px; margin-left: 2px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">本<br />地<br />存<br />储</div></div></div></foreignObject><text x="24" y="319" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">本地存储...</text></switch></g><path d="M 501 318 L 266.38 318.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 261.13 318.65 L 268.12 315.13 L 266.38 318.63 L 268.14 322.13 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 618.01 380.07 L 52.37 381.96" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 47.12 381.98 L 54.11 378.45 L 52.37 381.96 L 54.13 385.45 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="292" y="360" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 370px; margin-left: 322px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">新的令牌</div></div></div></foreignObject><text x="322" y="374" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">新的令牌</text></switch></g><path d="M 23.5 230 L 23.5 196.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 23.5 191.12 L 27 198.12 L 23.5 196.37 L 20 198.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="501" y="60" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 70px; margin-left: 531px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">验证失败</div></div></div></foreignObject><text x="531" y="74" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证失败</text></switch></g><rect x="511" y="110" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 120px; margin-left: 541px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">验证通过</div></div></div></foreignObject><text x="541" y="124" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证通过</text></switch></g><rect x="315" y="60" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 70px; margin-left: 345px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">验证失败</div></div></div></foreignObject><text x="345" y="74" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证失败</text></switch></g><path d="M 438.5 270 L 439 317" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>

## 携带令牌请求API

这里就是需要注意的就是如何携带`token`请求`API`。

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="487px" viewBox="-0.5 -0.5 487 252" style="max-width:100%;max-height:252px;"><defs/><g><rect x="1" y="1" width="45" height="250" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 126px; margin-left: 2px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">携<br />带<br />令<br />牌<br />访<br />问<br />API</div></div></div></foreignObject><text x="24" y="130" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">携带令牌访问API...</text></switch></g><rect x="86" y="58.5" width="90" height="45" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 81px; margin-left: 87px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">本地存储</div></div></div></foreignObject><text x="131" y="85" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">本地存储</text></switch></g><rect x="231" y="1" width="45" height="80" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 41px; margin-left: 232px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">拦<br />截<br />令<br />牌</div></div></div></foreignObject><text x="254" y="45" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">拦截令牌...</text></switch></g><rect x="231" y="111" width="45" height="80" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 151px; margin-left: 232px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">验<br />证<br />令<br />牌</div></div></div></foreignObject><text x="254" y="155" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证令牌...</text></switch></g><path d="M 47 31 L 223.64 31" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 228.89 31 L 221.89 34.5 L 223.64 31 L 221.89 27.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 276 41 L 301 41 Q 311 41 311 51 L 311 121 Q 311 131 301 131 L 282.37 131" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 277.12 131 L 284.12 127.5 L 282.37 131 L 284.12 134.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 276 151 L 434.63 151" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 439.88 151 L 432.88 154.5 L 434.63 151 L 432.88 147.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 231 151 L 52.37 150.03" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 47.12 150.01 L 54.14 146.54 L 52.37 150.03 L 54.1 153.54 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="91" y="131" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 141px; margin-left: 121px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">令牌失效</div></div></div></foreignObject><text x="121" y="145" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">令牌失效</text></switch></g><rect x="315" y="51" width="30" height="60" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 81px; margin-left: 330px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">取<br />得<br />令<br />牌</div></div></div></foreignObject><text x="330" y="85" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">取得令牌...</text></switch></g><rect x="101" y="11" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 21px; margin-left: 131px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">请求API</div></div></div></foreignObject><text x="131" y="25" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">请求API</text></switch></g><rect x="441" y="1" width="45" height="250" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 43px; height: 1px; padding-top: 126px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">API<br />池</div></div></div></foreignObject><text x="464" y="130" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">API...</text></switch></g><path d="M 441 209 L 51.37 209" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 46.12 209 L 53.12 205.5 L 51.37 209 L 53.12 212.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="186" y="219" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 229px; margin-left: 216px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">获得数据</div></div></div></foreignObject><text x="216" y="233" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">获得数据</text></switch></g><rect x="291" y="151" width="130" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 161px; margin-left: 356px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">令牌有效,fangwenAPI</div></div></div></foreignObject><text x="356" y="165" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">令牌有效,fangwenAPI</text></switch></g><path d="M 86 81 L 50.37 81.85" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 45.12 81.97 L 52.03 78.31 L 50.37 81.85 L 52.2 85.31 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>

## pom.xml中需要的依赖包

```md
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jdbc</artifactId>
</dependency>
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <scope>runtime</scope>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>2.1.2</version>
</dependency>
<!-- https://mvnrepository.com/artifact/com.alibaba/druid -->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.1.22</version>
</dependency>
<!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt</artifactId>
    <version>0.9.0</version>
</dependency>
<!-- https://mvnrepository.com/artifact/org.mindrot/jbcrypt -->
<dependency>
    <groupId>org.mindrot</groupId>
    <artifactId>jbcrypt</artifactId>
    <version>0.4</version>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
    <exclusions>
      <exclusion>
        <groupId>org.junit.vintage</groupId>
        <artifactId>junit-vintage-engine</artifactId>
      </exclusion>
    </exclusions>
</dependency>
```

## 程序整体结构

程序整体结构放在这里，可以作为参考。

```md
.
├── .idea
├── src
│   └── main
|       ├── java
|       |   └── org
|       |       └── example
|       |           ├── controller
|       |           |   └── UserController.java
|       |           ├── dao
|       |           |   └── UserMapper.java
|       |           ├── domain
|       |           |   └── User.java
|       |           ├── service
|       |           |   ├── UserService.java
|       |           |   └── Impl
|       |           |      └── UserServiceImpl.java
|       |           ├── utils
|       |           |   ├── JwtCfg.java
|       |           |   ├── JwtFilter.java
|       |           |   └── JwtUtils.java
|       |           └── Application.java
|       |           
|       |           
|       └── resources
|           ├── org
|           |   └── example
|           |       └──dao
|           |          └── UserMapper.xml
|           └── application.properties
├── target
└── pom.xml
```

## 编写UserController.java

这里包含一些`API`接口。只有`user/login`没有被拦截，其它接口都需要`token`认证才能够访问。

```java
package org.example.controller;

import org.example.domain.User;
import org.example.service.UserService;
import org.example.utils.JwtUtils;
import org.mindrot.jbcrypt.BCrypt;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpServletResponse;
import java.util.List;

@RestController
@RequestMapping("/user")
public class UserController {

    @Autowired
    private UserService userService;

    @Autowired
    private User user;

    @GetMapping("test/findAll")
    public List<User> findAll(){
        System.out.println("Controller表现层，查询所有用户");
        System.out.println(user);
        List<User> all = userService.findAll();
        for (User user : all) {
            System.out.println(user);
        }
        return all;
    }

    @PostMapping("test/addUser")
    public String addUser(User user){
            user.setPassword(BCrypt.hashpw(user.getPassword(),BCrypt.gensalt()));
            System.out.println("Controller表现层，增加用户");
            userService.addUser(user);
            return "添加用户成功";
    }

    @PostMapping("/login")
    public String login(HttpServletResponse response, User user) {
        // 查询数据库，查找此用户输入信息是否正确
        User users = null;
        users = userService.findUser(user);
        System.out.println(users.getUsername()+":"+users.getPassword());
        if(!BCrypt.checkpw(user.getPassword(),users.getPassword())){
            return "你输入的用户名或密码有误";
        }
        else{
            System.out.println(user);
            String token = JwtUtils.geneJsonWebToken(users.getUsername(), users.getPassword());
            // 将token放在响应头
            response.setHeader("Authorization", "Bearer "+token);
            return "Bearer "+token;
        }
    }

    @RequestMapping("test/secure/check")
    public String check(){
        return "登录成功";
    }

}
```

## 编写UserMapper.java

这里是持久层的代码，创建访问数据库的接口，需要使用注解或者和一个同名的`xml`文件配合使用。访问数据库需要实现这些接口的功能。

```java
package org.example.dao;

import org.example.domain.User;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface UserMapper {

    //查找所有的用户
    List<User> findAll();

    //增加一个用户
    void addUser(User user);

    //查找一个用户
    User findUser(User user) ;
}
```

## 编写User.java

实体类，一般和数据库的属性是一致的，可以将数据库的一张表封装成一个实体类。

```java
package org.example.domain;

import org.springframework.context.annotation.Configuration;

import java.io.Serializable;

@Configuration
public class User implements Serializable {
    //用户名
    private String username;
    //密码
    private String password;

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }
    
    @Override
    public String toString() {
        return "User{" +
                ", username='" + username + '\'' +
                ", password='" + password + '\'' +
                '}';
    }
}
```

## 编写UserService.java

业务层接口代码，和表现层接口代码一样，配合使用。

```java
package org.example.service;

import org.example.domain.User;

import java.util.List;

public interface UserService {

    List<User> findAll();

    void addUser(User user);

    User findUser(User user) ;
}
```

## 编写UserServiceImpl.java

实现业务层接口功能，供表现层调用。

```java
package org.example.service.Impl;

import org.example.dao.UserMapper;
import org.example.domain.User;
import org.example.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class UserServiceImpl implements UserService {
    @Autowired
    private UserMapper userMapper;

    @Override
    public List<User> findAll() {
        System.out.println("Service业务层，查询所有用户");
        return userMapper.findAll();
    }

    @Override
    public void addUser(User user) {
        System.out.println("Service业务层，保存用户");
        userMapper.addUser(user);
    }

    @Override
    public User findUser(User user) {
        return userMapper.findUser(user);
    }
}
```

## 编写JwtCfg.java

JWT的配置类，例如可以配置具体的拦截的路径，现在我也只会配置这个^_^。

```java
package org.example.utils;

import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class JwtCfg {

    @Bean
    public FilterRegistrationBean<JwtFilter> jwtFilter() {
        final FilterRegistrationBean<JwtFilter> registrationBean = new FilterRegistrationBean<>();
        registrationBean.setFilter(new JwtFilter());
        // 对/user/test/*下的url进行拦截验证
        registrationBean.addUrlPatterns("/user/test/*");

        return registrationBean;
    }
}
```

## 编写JwtFilter.java

这个类的作用是拦截器`（Filter）`，拦截的路径就是在`JwtCfg.java`中配置，可以获取到请求头中的令牌，也就是`token`，这个类我感觉也是比较核心的一个类，对于携带`token`的用户，需要将`token`拿过来，然后解码，获取到里面的值。

`token`就是类似这样的一串代码，前面的`Bearer `不包含在`token`中。当`token`过期的时候，`JWT`会自动判断其失效的，不用自己手动配置。

```md
Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsInVzZXJOYW1lIjoiMTExIiwiaWF0IjoxNTkxMDA3Njk4LCJleHAiOjE1OTEwOTQwOTh9.fidk9TBllhA_lb9CNODCf3HD4dp-NNsyOdPU0O3Wnhw
```

解码之后就变成了这样

```md
{sub=admin, userName=111, iat=1591007698, exp=1591094098}
```

里面也还可以包含很多这样的键值对，下面是它们的含义。

:::tip
JWT标准里面定好的claim有：

iss(Issuser)：代表这个JWT的签发主体；

sub(Subject)：代表这个JWT的主体，即它的所有人；

aud(Audience)：代表这个JWT的接收对象；

exp(Expiration time)：是一个时间戳，代表这个JWT的过期时间；

nbf(Not Before)：是一个时间戳，代表这个JWT生效的开始时间，意味着在这个时间之前验证JWT是会失败的；

iat(Issued at)：是一个时间戳，代表这个JWT的签发时间；

jti(JWT ID)：是JWT的唯一标识。
:::

```java
package org.example.utils;

import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureException;
import org.springframework.web.filter.GenericFilterBean;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class JwtFilter extends GenericFilterBean {

    /**
     * 秘钥
     */
    public static final String SECRET_KEY = "secretkey";

    @Override
    public void doFilter(final ServletRequest req, final ServletResponse res, final FilterChain chain)
            throws IOException, ServletException{

        final HttpServletRequest request = (HttpServletRequest) req;
        final HttpServletResponse response = (HttpServletResponse) res;

        // 从request中获取authorization
        final String authHeader = request.getHeader("authorization");

            // 判断token是否是用Bearer 开头的
            String header = "Bearer ";
            if (authHeader == null || !authHeader.startsWith(header)) {
                //没有token或者token格式不对则抛一个异常，
                //也可以自己设置返回的状态码
                //response.setStatus(HttpServletResponse.SC_BAD_GATEWAY);
                //在前端取得这样的状态码则说明请求失败
                throw new ServletException("Missing or invalid Authorization header");
            }
            else {
                // 然后从授权处获取JWT令牌，去掉前面的Bearer
                final String token = authHeader.substring(7);

                try {
                    // 使用JWT解析器检查签名是否与Key "secretkey "有效。
                    final Claims claims = Jwts.parser().setSigningKey(SECRET_KEY).parseClaimsJws(token).getBody();
                    System.out.println(claims);
                    System.out.println(claims.getExpiration().getTime());
                    System.out.println(System.currentTimeMillis());
                    // 在请求标题中添加claims
                    request.setAttribute("claims", claims);
                } catch (Exception e) {
                    throw new ServletException("Invalid token");
                }
        }
        chain.doFilter(req, res);
    }
}
```

## JwtUtils.java

这个是生成token的类。

```java
package org.example.utils;

import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import org.springframework.util.StringUtils;

import java.util.Date;

public class JwtUtils {

    public static final String SUBJECT = "admin";

    /**
     * 过期时间，毫秒，一天
     *
     */
    public static final long EXPIRE = 1000 * 60 * 60 * 24;

    /**
     * 秘钥
     */
    public static final String SECRET_KEY = "secretkey";

    /**
     * 生成jwt
     * @param username
     * @param password
     * @return
     */
    public static String geneJsonWebToken(String username, String password) {

        if (StringUtils.isEmpty(username) || StringUtils.isEmpty(password)) {
            return "用户名或密码不能为空";
        }

        return Jwts.builder().setSubject(SUBJECT)
                .claim("userName", username)
                .setIssuedAt(new Date())
                .setExpiration(new Date(System.currentTimeMillis() + EXPIRE))
                .signWith(SignatureAlgorithm.HS256, SECRET_KEY).compact();
    }

}
```

## 编写Application.java

`SpringBoot`的主入口类。

```java
package org.example;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.transaction.annotation.EnableTransactionManagement;

@SpringBootApplication
@EnableTransactionManagement
@MapperScan("org.example.dao")
class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

}
```

## 编写UserMapper.xml

这个相当于持久层的接口`UserMapper.java`实现类，里面可以写一些SQL语句，对数据库进行CRUD。

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.dao.UserMapper">
    <!-- 开启二级缓存 -->
    <cache/>
    <select id="findAll" resultType="user">
      select * from user
    </select>
    <insert id="addUser" parameterType="user">
        insert into User (username,password) values (
        #{username},#{password}
        );
    </insert>
    <select id="findUser" parameterType="user" resultType="user">
        select * from user where username=#{username};
    </select>
</mapper>
```

## application.properties

springboot的配置文件。

```md
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/srcrs?useSSL=false&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=123456

mybatis.mapper-locations=classpath:org/example/dao/*.xml
mybatis.type-aliases-package=org.example.domain
```

至此就已经编写完了。目前可以做的就是通过`user/login`接口获得token令牌，然后通过这个令牌就可以访问其它所有已经定义好的接口，实现了简单的身份认证。但是这也还是不够用的，例如有些接口是不可以被外界所使用的，尤其是对一些重要的数据，所以接下来还得需要一个安全框架，实现认证与授权，通过定义一个个角色，对这些角色授予访问部分API接口的权限，能够让API接口更加的安全，现在这个样子是不行的，计划准备使用spring security来实现。

还有需要注意一些坑，最好要保证包的版本一直，否则可能会出一些莫名其妙的问题，例如`jwt`包，我开始选择的是`0.11.1`的这个包，但是不知道为什么老师报错，然后我就换成了`0.9.0`就好了，很奇怪。

另外就是做接口测试，可以在chrome中装一个插件[Tabbed Postman - REST Client](https://chrome.google.com/webstore/detail/tabbed-postman-rest-clien/coohjcphdfgbiolnekdpbcijmhambjff?utm_source=chrome-ntp-icon)，这个插件就可以做接口测试，还比较好用。

## 参考链接

[Spring Boot整合JWT实现认证](https://blog.csdn.net/xiuaiba/article/details/106386212)

[前后端分离后如何实现登录？前端基于vue、axios，后端基于springSecurity、JWT、BCR算法加密解密](https://www.bilibili.com/video/BV1KE41157nL)

[JWT在身份认证方面的应用](https://www.jianshu.com/p/fcc1a6482143?from=timeline)